"use strict";!function(){angular.module("emd.client.socket.module",["btford.socket-io"]).service("SocketService",["socketFactory",function(e){return e()}])}();var quotesApp=angular.module("quotes",["ngResource","btford.socket-io","emd.client.socket.module","emd.ng-xtorage"]);quotesApp.config(["$xtorageProvider",function(e){e.storage="sessionStorage",e.storageExpiration=216e5}]),quotesApp.constant("VERSION","0.0.1"),quotesApp.constant("author",{name:"Eric Mendes Dantas",github:"https://github.com/ericmdantas"}),quotesApp.factory("QuotesResource",["$resource",function(e){var t="/api/quotes/:type/:id",o={id:"@id"},r={update:{method:"PUT"}};return e(t,o,r)}]),quotesApp.service("Randomizer",[function(){var e=function(e){for(var t,o,r=e.length;r;)o=Math.floor(Math.random()*r--),t=e[r],e[r]=e[o],e[o]=t;return e},t=function(e){var t=e.length,o=Math.floor(Math.random()*t);return[e[o]]};this.shuffle=e,this.shuffleSingle=t}]),quotesApp.service("QuotesDAO",["$q","SocketService","QuotesModel","QuotesCache","QuotesResource",function(e,t,o,r,n){var a=function(){var t=e.defer(),a=r.getArray();if(a)return e.when(a);var u=function(e){var n=[];angular.forEach(e,function(e){n.push(new o(e))}),r.saveArray(n),t.resolve(n)};return n.query().$promise.then(u),t.promise},u=function(e){if(!angular.isString(e))throw new Error("O id passado não é uma string válida. Não será possível favoritar a mensagem.");t.emit("fav:quote",e)},s=function(t){var r=e.defer(),a=function(e){var t=new o(e);r.resolve(t)},u=function(e){var t={msg:e.data.error,status:e.status};r.reject(t)};return angular.isObject(t)&&t instanceof o&&t.isValid()?(t.quote=t.removeQuotationMarks(),n.save(t).$promise.then(a,u),r.promise):(r.reject(new Error("Não é possível criar uma nova frase, pois a mesma não é válida.")),r.promise)};this.getAll=a,this.favQuote=u,this.createQuote=s}]),quotesApp.service("QuotesCache",["$xtorage",function(e){var t="q",o=function(o){if(!angular.isArray(o))throw new Error("A informação a ser armazenada em cache deve ser um array.");e.save(t,o)},r=function(){return e.get(t)};this.saveArray=o,this.getArray=r}]),quotesApp.factory("QuotesModel",[function(){function e(e){this.author=null,this.quote=null,this.likes=0,angular.extend(this,e)}return e.prototype={isValid:function(){return angular.isString(this.author)&&angular.isString(this.quote)},removeQuotationMarks:function(){var e=this.quote,t=/^"|^'|"$|'$/g;return e=e.replace(t,"")}},e}]),quotesApp.controller("QuotesController",["$rootScope","$scope","QuotesModel","QuotesDAO","SocketService","Randomizer",function(e,t,o,r,n,a){t.quotes=[],t.quotesKeeper=[],t.errorQuoteCreation=null,t.favQuote=r.favQuote,t.quoteInstance=new o,t.order="author";var u=function(){var e=function(e){t.quotes=e,t.quotesKeeper=angular.copy(t.quotes)};r.getAll().then(e)};n.on("quote:faved",function(e){angular.forEach(t.quotes,function(o,r){o._id===e&&(t.quotes[r].likes+=1)})}),t.createQuote=function(e){var n=function(e){t.errorQuoteCreation=null,t.quoteInstance=new o,t.quotes.push(e)},a=function(e){t.errorQuoteCreation=e.msg};r.createQuote(e).then(n,a)},t.setSingle=function(e){if(!angular.isArray(e))throw new Error("Houve um erro ao randomizar as mensagens. O objeto passado não é um objeto ou array válido.");t.quotes=a.shuffleSingle(t.quotes),t.singleView=!0},t.setMultiple=function(){t.quotes=t.quotesKeeper,t.singleView=!1},t.setOrder=function(e){t.order=e},t.randomize=function(){t.quotes=a.shuffleSingle(t.quotesKeeper)},t.shuffle=function(){t.setOrder(null),a.shuffle(t.quotes)},u()}]),quotesApp.directive("activable",[function(){return function(e,t,o){t.on("click",function(){var e=o.deactive||null;if(!angular.isString(e))throw new Error("É necessário informar o caminho do element a ser removido a classe active.");$(e).removeClass("active"),t.addClass("active")})}}]),quotesApp.directive("like",[function(){var e="partials/includes/likes.html",t=function(e,t){e.star="fa-star-o",t.on("click",function(){e.star="fa-star"})};return{restrict:"E",templateUrl:e,link:t,scope:{liked:"&",numberlikes:"@"}}}]),quotesApp.directive("showOtherOptions",[function(){var e=function(e,t){t.on("click",function(){$(".opt").not(t).slideToggle(),t.find(".fa").toggleClass("fa-minus")})};return e}]);