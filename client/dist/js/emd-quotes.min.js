"use strict";!function(){angular.module("emd.client.socket.module",["btford.socket-io"]).service("SocketService",["socketFactory",function(a){return a()}])}();var quotesApp=angular.module("quotes",["ngResource","btford.socket-io","emd.client.socket.module","emd.ng-xtorage"]);quotesApp.constant("author",{name:"Eric Mendes Dantas",github:"https://github.com/ericmdantas"}),quotesApp.controller("QuotesController",["$scope","$xtorage","QuotesModel","QuotesDAO","SocketService","Randomizer",function(a,b,c,d,e,f){a.quotes=[],a.quotesKeeper=[],a.errorQuoteCreation=null,a.favQuote=d.favQuote,a.quoteInstance=new c;var g=function(){var b=function(b){a.quotes=b,a.quotesKeeper=angular.copy(a.quotes),a.$broadcast("quotes-ready")};d.getAll().then(b)};e.on("quote:faved",function(b){for(var c=0;c<a.quotes.length;c++)if(b===a.quotes[c]._id){a.quotes[c].likes+=1;break}}),a.setOrder=function(b){if(!angular.isString(b))throw new Error("Ordenação incorreta. O tipo do parâmetro deve ser uma string.");a.getOrder=b},a.createQuote=function(b){var e=function(){a.errorQuoteCreation=null,a.quoteInstance=new c,b.likes=0,a.quotes.push(b)},f=function(b){a.errorQuoteCreation=b.msg};d.createQuote(b).then(e,f)},a.setSingle=function(b){if(!angular.isArray(b))throw new Error("Houve um erro ao randomizar as mensagens. O objeto passado não é um objeto ou array válido.");var c=b.length,d=Math.floor(Math.random()*c);a.quotes=[b[d]],a.singleView=!0},a.setMultiple=function(){a.singleView=!1,a.quotes=a.quotesKeeper},a.randomize=function(){a.quotes=f.shuffleSingle(a.quotesKeeper)},a.setOrder("author"),g()}]),quotesApp.directive("activable",[function(){return function(a,b,c){b.on("click",function(){var a=c.deactive||null;if(!angular.isString(a))throw new Error("É necessário informar o caminho do element a ser removido a classe active.");$(a).removeClass("active"),b.addClass("active")})}}]),quotesApp.directive("emdOptionsNavigation",["$timeout",function(a){var b="partials/includes/options-navigation.html",c=["$scope","Randomizer",function(a,b){a.modalOptions={titulo:null,conteudo:[]},a.onViewClick=function(){a.modalOptions={titulo:"View",conteudo:[{nome:"Single",onClick:function(){a.setSingle(a.quotes)}},{nome:"Multiple",onClick:a.setMultiple}]}},a.onOrderByClick=function(){a.modalOptions={titulo:"Order By",conteudo:[{nome:"Quote",onClick:function(){a.getOrder="quotes"}},{nome:"Author",onClick:function(){a.getOrder="author"}},{nome:"Most liked",onClick:function(){a.getOrder="-likes"}}]}},a.onShuffleClick=function(){a.getOrder=null,b.shuffle(a.quotes)}}],d=function(b){b.$watch("modalOptions",function(){a(function(){switch(b.modalOptions.conteudo.length){case 2:$(".modal-body .btn-group .btn").addClass("col-xs-6");break;case 3:$(".modal-body .btn-group .btn").addClass("col-xs-4")}},3)})};return{restrict:"E",templateUrl:b,controller:c,link:d}}]),quotesApp.directive("showModalWhenNoQuotes",[function(){var a="partials/includes/modal-loading.html",b=function(a){var b="#modal-loading-quotes";$(b).modal("show");var c=a.$on("quotes-ready",function(){$(b).modal("hide"),c()})},c={};return{restrict:"E",templateUrl:a,link:b,scope:c}}]),quotesApp.directive("like",[function(){var a="partials/includes/likes.html",b=function(a,b){a.star="fa-star-o",b.on("click",function(){a.star="fa-star"})};return{restrict:"E",templateUrl:a,link:b,scope:{liked:"&",numberlikes:"@"}}}]),quotesApp.factory("QuotesModel",[function(){function a(a){this.author=null,this.quote=null,this.likes=0,angular.extend(this,a)}return a.prototype={isValid:function(){return angular.isString(this.author)&&angular.isString(this.quote)}},a}]),quotesApp.factory("QuotesResource",["$resource",function(a){var b="/api/quotes/:type/:id",c={id:"@id"},d={update:{method:"PUT"}};return a(b,c,d)}]),quotesApp.service("QuotesDAO",["$q","SocketService","QuotesModel","QuotesResource",function(a,b,c,d){var e=function(){var b=a.defer(),e=function(a){var d=[];angular.forEach(a,function(a){d.push(new c(a))}),b.resolve(d)};return d.query().$promise.then(e),b.promise},f=function(a){if(!angular.isString(a))throw new Error("O id passado não é uma string válida. Não será possível favoritar a mensagem.");b.emit("fav:quote",a)},g=function(b){var e=a.defer(),f=function(){e.resolve()},g=function(a){var b={msg:a.data.error,status:a.status};e.reject(b)};return angular.isObject(b)&&b instanceof c&&b.isValid()?(d.save(b).$promise.then(f,g),e.promise):(e.reject(new Error("Não é possível criar uma nova frase, pois a mesma não é válida.")),e.promise)};this.getAll=e,this.favQuote=f,this.createQuote=g}]),quotesApp.service("Randomizer",[function(){var a=function(a){for(var b,c,d=a.length;d;)c=Math.floor(Math.random()*d--),b=a[d],a[d]=a[c],a[c]=b;return a},b=function(a){var b=a.length,c=Math.floor(Math.random()*b);return[a[c]]};this.shuffle=a,this.shuffleSingle=b}]);