"use strict";!function(){angular.module("emd.client.socket.module",["btford.socket-io"]).service("SocketService",["socketFactory",function(a){return a()}])}();var quotesApp=angular.module("quotes",["ngResource","btford.socket-io","emd.client.socket.module","emd.ng-xtorage"]);quotesApp.config(["$xtorageProvider",function(a){a.storage="sessionStorage",a.storageExpiration=216e5}]),quotesApp.constant("VERSION","0.0.1"),quotesApp.constant("author",{name:"Eric Mendes Dantas",github:"https://github.com/ericmdantas"}),quotesApp.controller("QuotesController",["$rootScope","$scope","QuotesModel","QuotesDAO","SocketService","Randomizer",function(a,b,c,d,e,f){b.quotes=[],b.quotesKeeper=[],b.errorQuoteCreation=null,b.favQuote=d.favQuote,b.quoteInstance=new c,b.order="author";var g=function(){var a=function(a){b.quotes=a,b.quotesKeeper=angular.copy(b.quotes)};d.getAll().then(a)};e.on("quote:faved",function(a){angular.forEach(b.quotes,function(c,d){c._id===a&&(b.quotes[d].likes+=1)})}),b.createQuote=function(a){var e=function(a){b.errorQuoteCreation=null,b.quoteInstance=new c,b.quotes.push(a)},f=function(a){b.errorQuoteCreation=a.msg};d.createQuote(a).then(e,f)},b.setSingle=function(a){if(!angular.isArray(a))throw new Error("Houve um erro ao randomizar as mensagens. O objeto passado não é um objeto ou array válido.");b.quotes=f.shuffleSingle(b.quotes),b.singleView=!0},b.setMultiple=function(){b.quotes=b.quotesKeeper,b.singleView=!1},b.setOrder=function(a){b.order=a},b.randomize=function(){b.quotes=f.shuffleSingle(b.quotesKeeper)},b.shuffle=function(){b.setOrder(null),f.shuffle(b.quotes)},g()}]),quotesApp.directive("activable",[function(){return function(a,b,c){b.on("click",function(){var a=c.deactive||null;if(!angular.isString(a))throw new Error("É necessário informar o caminho do element a ser removido a classe active.");$(a).removeClass("active"),b.addClass("active")})}}]),quotesApp.directive("like",[function(){var a="partials/includes/likes.html",b=function(a,b){a.star="fa-star-o",b.on("click",function(){a.star="fa-star"})};return{restrict:"E",templateUrl:a,link:b,scope:{liked:"&",numberlikes:"@"}}}]),quotesApp.directive("showOtherOptions",[function(){var a=function(a,b){b.on("click",function(){$(".opt").not(b).slideToggle(),b.find(".fa").toggleClass("fa-minus")})};return a}]),quotesApp.factory("QuotesModel",[function(){function a(a){this.author=null,this.quote=null,this.likes=0,angular.extend(this,a)}return a.prototype={isValid:function(){return angular.isString(this.author)&&angular.isString(this.quote)},removeQuotationMarks:function(){var a=this.quote,b=/^"|^'|"$|'$/g;return a=a.replace(b,"")}},a}]),quotesApp.factory("QuotesResource",["$resource",function(a){var b="/api/quotes/:type/:id",c={id:"@id"},d={update:{method:"PUT"}};return a(b,c,d)}]),quotesApp.service("QuotesCache",["$xtorage",function(a){var b="q",c=function(c){if(!angular.isArray(c))throw new Error("A informação a ser armazenada em cache deve ser um array.");a.save(b,c)},d=function(){return a.get(b)};this.saveArray=c,this.getArray=d}]),quotesApp.service("QuotesDAO",["$q","SocketService","QuotesModel","QuotesCache","QuotesResource",function(a,b,c,d,e){var f=function(){var b=a.defer(),f=d.getArray();if(f)return a.when(f);var g=function(a){var e=[];angular.forEach(a,function(a){e.push(new c(a))}),d.saveArray(e),b.resolve(e)};return e.query().$promise.then(g),b.promise},g=function(a){if(!angular.isString(a))throw new Error("O id passado não é uma string válida. Não será possível favoritar a mensagem.");b.emit("fav:quote",a)},h=function(b){var d=a.defer(),f=function(a){var b=new c(a);d.resolve(b)},g=function(a){var b={msg:a.data.error,status:a.status};d.reject(b)};return angular.isObject(b)&&b instanceof c&&b.isValid()?(b.quote=b.removeQuotationMarks(),e.save(b).$promise.then(f,g),d.promise):(d.reject(new Error("Não é possível criar uma nova frase, pois a mesma não é válida.")),d.promise)};this.getAll=f,this.favQuote=g,this.createQuote=h}]),quotesApp.service("Randomizer",[function(){var a=function(a){for(var b,c,d=a.length;d;)c=Math.floor(Math.random()*d--),b=a[d],a[d]=a[c],a[c]=b;return a},b=function(a){var b=a.length,c=Math.floor(Math.random()*b);return[a[c]]};this.shuffle=a,this.shuffleSingle=b}]);